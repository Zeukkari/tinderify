"use strict";angular.module("tinderApp",["ngResource","ngRoute","ngDialog","btford.socket-io","ui.bootstrap"]).config(["$routeProvider",function(t){t.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/matches",{templateUrl:"views/matches.html",controller:"MatchCtrl",controllerAs:"match"}).when("/swipe",{templateUrl:"views/swipe.html",controller:"SwipeCtrl",controllerAs:"swipe"}).when("/commands",{templateUrl:"views/commands.html",controller:"CommandsCtrl",controllerAs:"commands"}).when("/photos",{templateUrl:"view/photos.html"}).otherwise({redirectTo:"/"})}]).factory("Matches",["$resource",function(t){return t("http://localhost:5000/api/users/matches")}]).factory("MatchMessage",["$resource",function(t){return t("http://localhost:5000/api/users/matches/:id/message",{id:"@id"})}]).factory("Recommendations",["$resource",function(t){return t("http://localhost:5000/api/users/recommendations",null,{get:{method:"get",isArray:!0}})}]).factory("JudgeRecommendation",["$resource",function(t){return t("http://localhost:5000/api/users/recommendations/:id/judge",{id:"@id"})}]).factory("Statistics",["$resource",function(t){return t("http://localhost:5000/api/commands/statistics")}]).factory("Autolike",["$resource",function(t){return t("http://localhost:5000/api/commands/autolike")}]).factory("mySocket",["socketFactory",function(t){return t({ioSocket:io.connect("localhost:5000")})}]),angular.module("tinderApp").controller("MainCtrl",["$scope","Statistics",function(t,e){this.statistics=e.get()}]),angular.module("tinderApp").controller("MatchCtrl",["$scope","Matches","MatchMessage","$interval","$timeout","ngDialog","mySocket",function(t,e,s,i,o,a,n){this.init=(()=>{this.lastSuccesfulUpdate="",this.isMatchListEnabled=!0,this.activeSlideIndex=0,this.matches={},this.getUpdates(),this.filterCommonConnections=0,this.filterIsMatched=!0}),this.openChat=(t=>{this.isChatEnabled=!0,this.isMatchListEnabled=!1,this.messages=this.sortMessages(this.matches[t].messages),this.currentMatch=this.matches[t]}),this.sortMessages=(t=>_.sortBy(t,t=>t.sent)),this.sortMatchKeys=(t=>_.sortBy(t,t=>t.last_activity_date).reverse().map(t=>t.id)),this.returnFromChat=(()=>{this.isChatEnabled=!1,this.isMatchListEnabled=!0}),this.openPhotos=(t=>{a.open({template:"views/photos.html",data:this.matches[t],width:"80%",height:700,controller:["$scope",function(t){t.active=0}]})}),this.filter=(()=>{let t=this.filterCommonConnections,e=this.filterIsMatched,s=this.filterHasTexted,i=_.filter(this.matches,i=>i.common_connections>=t&&i.matched==e&&(!s||s&&i.messages.length>0));this.sortedKeys=this.sortMatchKeys(i)}),this.sendMessage=(()=>s.save({id:this.currentMatch.match_id,body:this.chatMessage})),this.getUpdates=(()=>{e.get({since:this.lastSuccesfulUpdate},t=>{this.processUpdates(t.toJSON())})}),this.processUpdates=(t=>{for(let e in t){let s=this.matches[e],i=t[e];console.info(s),console.info(i),void 0!==s?(s.messages=this.sortMessages(_.unionBy(s.messages,i.messages,"id")),console.info(s),console.info("current = "+this.currentMatch),void 0!==this.currentMatch&&this.currentMatch.id===s.id&&(this.currentMatch=s)):this.matches[e]=i}this.sortedKeys=this.sortMatchKeys(this.matches),this.lastSuccesfulUpdate=(new Date).toISOString(),this.filter()});var c=this.processUpdates;n.on("updates",function(t){console.log("received updates"),c(t)}),this.init()}]),angular.module("tinderApp").controller("CommandsCtrl",["$scope","Autolike",function(t,e){this.autolike=(t=>{e.save({maxcount:t})})}]),angular.module("tinderApp").controller("SwipeCtrl",["$scope","Recommendations","JudgeRecommendation","$window","$interval","$timeout",function(t,e,s,i,o,a){this.loadNewRecommendations=(()=>{this.isLoading=!0,this.loadingInterval=o(()=>{this.loadingText=3==this.loadingText.length?"":this.loadingText+"."},300),e.get(t=>{o.cancel(this.loadingInterval),this.isLoading=!1,this.currentIndex=0,this.recommendations=t,this.currentRecommendation=this.recommendations[0]})}),this.init=(()=>{this.loadingText="",this.isLoading=!1,this.loadNewRecommendations(),this.showMatchInfo=!1,this.swipeCount=0,this.matchCount=0}),this.init(),this.showMatchedNotification=(()=>{this.showMatchInfo=!0,a(()=>{this.showMatchInfo=!1},100)}),this.judge=(t=>{s.save({id:this.currentRecommendation.id,like:t},t=>{this.swipeCount++,t.matched&&(this.showMatchedNotification(),this.matchCount=0)}),this.currentIndex+1==this.recommendations.length?this.loadNewRecommendations():this.currentRecommendation=this.recommendations[++this.currentIndex]});var n=this.judge;angular.element(i).on("keydown",function(t){t.preventDefault(),t.stopPropagation(),"ArrowLeft"===t.originalEvent.code?n(!1):"ArrowRight"===t.originalEvent.code&&n(!0),console.log(t)})}]),angular.module("tinderApp").run(["$templateCache",function(t){t.put("views/chat.html",""),t.put("views/commands.html",'<h4>Autolike</h4> <form class="form-inline"> <div class="form-group"> <label for="maxCount">Max count</label> <input type="text" class="form-control" id="maxCount" size="3" ng-model="commands.maxAutolikeCount"> </div> <button class="btn btn-default" ng-click="commands.autolike()">Autolike</button> </form>'),t.put("views/main.html",'<h1>Welcome!</h1> <div container> <div class="row"> <div class="col-sm-6">Number of users swiped</div> <div class="col-sm-6">{{main.statistics.swiped}}</div> </div> <div class="row"> <div class="col-sm-6">Number of users match</div> <div class="col-sm-6">{{main.statistics.matched}}</div> </div> <div class="row"> <div class="col-sm-6">Match rate</div> <div class="col-sm-6">{{main.statistics.match_rate}}</div> </div> </div>'),t.put("views/matches.html",'<h5>Filter</h5> <div> <form class="form-inline"> <div class="form-group"> <label for="connections">Common connections</label> <input type="text" class="form-control" id="connections" size="3" ng-model="match.filterCommonConnections" ng-change="match.filter()"> </div> <div class="checkbox"> <label><input type="checkbox" ng-model="match.filterIsMatched" ng-change="match.filter()">Matched</label> </div> <div class="checkbox"> <label><input type="checkbox" ng-model="match.filterHasTexted" ng-change="match.filter()">Texted</label> </div> \x3c!-- <button class="btn btn-default" ng-click="match.filter()">Filter</button> --\x3e </form> </div> <p></p> <div ng-show="match.isChatEnabled"> <div ng-click="match.returnFromChat()" class="btn-link">Back</div> <div class="container chat-view"> <div ng-repeat="message in match.currentMatch.messages"> <div class="row"><b>{{ message.sender }}</b> {{ message.sent | date:\'MM-dd HH:mm:ss\'}} </div> <div class="row"> {{ message.message }} </div> </div> </div> <div class="row"> <div class="col-sm-10"> <input type="text" ng-model="match.chatMessage" class="form-control"> </div> <div class="col-sm-2"> <input type="button" class="btn-primary" ng-click="match.sendMessage()" value="Send"> </div> </div> </div> <div class="container" ng-show="match.isMatchListEnabled"> <div ng-repeat="(index, key) in match.sortedKeys" class="row row-bottom-margin"> <div class="col-sm-1"><a ng-click="match.openChat(key)">{{match.matches[key].name }}</a></div> <div class="col-sm-2"><img ng-src="{{match.matches[key].thumbnails[0]}}" ng-click="match.openPhotos(key)"></div> <div class="col-sm-9">{{match.matches[key].messages.slice(-1)[0].message}}</div> </div> </div>'),t.put("views/photos.html",'<div uib-carousel active="active"> <div uib-slide ng-repeat="photo in ngDialogData.photos" index="$index"> \x3c!-- <div uib-slide class="row" ng-repeat="photo in ngDialogData.photos"> --\x3e <img ng-src="{{photo.url}}"> </div> </div> {{ngDialogData.name}} {{ngDialogData.age}} {{ngDialogData.bio}} \x3c!-- <div uib-carousel>\n  <div uib-slide ng-repeat="slide in  match.matches[key].photos track by slide.id" index="$index">\n    <img ng-src="{{slide.url}}" style="margin:auto;">\n    <div class="carousel-caption">\n      <h4>Slide {{slide.id}}</h4>\n      <p>{{slide.text}}</p>\n    </div>\n  </div>\n</div> --\x3e'),t.put("views/swipe.html",'<div ng-show="swipe.isLoading"> <h3 class="text-muted">Loading new matches {{swipe.loadingText}}</h3> \x3c!-- <img src="images/loading.gif"> --\x3e </div> <div ng-show="!swipe.isLoading"> <div id="swipeImageContainer"> <img id="swipe-photo" ng-src="{{swipe.currentRecommendation.photos[0].url}}"> </div> <div class="swipeInfoBox"> <p>Swiped {{swipe.swipeCount}}</p> <p>Matched: {{swipe.matchCount}}</p> </div> <div class="swipeBottomContainer"> <h4>{{swipe.currentRecommendation.name}} {{swipe.currentRecommendation.age}}</h4> <h5>{{swipe.currentRecommendation.bio}}</h5> <div class="btn-group-lg"> <button type="button" class="btn btn-danger btn-lg" ng-click="swipe.judge(false)">Pass</button> <button type="button" class="btn btn-success btn-lg" ng-click="swipe.judge(true)">Like</button> <h4 ng-show="swipe.showMatchInfo">Matched!</h4> </div> <h5 class="text-muted" style="padding-top: 5px">Either the buttons above or arrow keys left (pass) right (like) can be used.</h5> </div> </div>')}]);